---
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
          integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" rel="stylesheet">
    <link href="assets/css/mystyle.css" rel="stylesheet">
    <script crossorigin="anonymous" src="https://kit.fontawesome.com/c5e7391f02.js"></script>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'/>
    <title>{{ site.title }}</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        svg {
            width: 100%;
            height: 100vh;
            background: #191C1F;
        }

        .tooltip {
            position: absolute;
            padding: 6px;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #444;
            border-radius: 4px;
            white-space: normal;
            max-width: 400px;
            pointer-events: none;
            opacity: 0;
        }
    </style>

</head>
<body class="bg-dark d-flex flex-column h-100">

<div class="container-fluid blur unselectable p-0" id="graph-container">
    <svg></svg>
    <div class="tooltip"></div>

    <script>
        const svg = d3.select("svg");
        const tooltip = d3.select(".tooltip");
        const width = window.innerWidth;
        const height = window.innerHeight;

         svg
            .attr('width', width)
            .attr('height', height)
            .attr('viewBox', `0 0 ${width} ${height}`)
            // .attr('preserveAspectRatio', 'none');


        d3.json("assets/json/pubs.json").then(data => {
            // 1) Scales
            const xExtent = d3.extent(data, d => d.x);
            const yExtent = d3.extent(data, d => d.y);
            const yearExtent = d3.extent(data, d => d.pub_year);
            const rExtent = d3.extent(data, d => d.num_citations);

            const xScale = d3.scaleLinear().domain(xExtent).range([40, width - 40]);
            const yScale = d3.scaleLinear().domain(yExtent).range([height - 40, 40]);
            const rScale = d3.scaleSqrt().domain(rExtent).range([10, 30]);
            const colorScale = d3.scaleSequential(d3.interpolateMagma).domain(yearExtent);

            // 2) Circle nodes
            const nodes = data.map((d, i) => ({
                id: i,
                x: xScale(d.x),
                y: yScale(d.y),
                x_orig: xScale(d.x),
                y_orig: yScale(d.y),
                r: rScale(d.num_citations),
                num_citations: d.num_citations,
                color: colorScale(d.pub_year),
                title: d.bib_dict.title,
                citation: d.bib_dict.citation,
                author: d.bib_dict.author,
                link: `https://scholar.google.com/citations?view_op=view_citation&citation_for_view=${d.author_pub_id}`,
                selected: false
            }));

            // 3) Spread circles with a collideâ€only force
            const circleSim = d3.forceSimulation(nodes)
                .force("x", d3.forceX(d => d.x_orig).strength(1.0))
                .force("y", d3.forceY(d => d.y_orig).strength(1.0))
                .force("collide", d3.forceCollide(d => d.r + 1).strength(0.8))
                .stop();
            for (let i = 0; i < 200; ++i) circleSim.tick();

            // 4) Draw circles
            svg.selectAll("rect")
                .data(nodes)
                .enter().append("rect")
                .attr("x", d => d.x - d.r)
                .attr("y", d => d.y - d.r)
                .attr("rx", d => d.r)
                .attr("width", d => 2 * d.r)
                .attr("height", d => 2 * d.r)
                .attr("fill", d => d.color)
                .attr("opacity", 1.0)

                // Add a label box for each circle
                .on("mouseover", (e, d) => {
                    // Make the mouse cursor a pointer
                    e.currentTarget.style.cursor = "pointer";

                    // Format the authors list
                    let authors = d.author.split(" and ");
                    if (authors.length > 2) {
                        authors = authors.join(", ");
                        // Do a final and for the last two authors
                        authors = authors.replace(/, ([^,]*)$/, ", and $1");
                    } else {
                        authors = authors.join(" and ");
                    }

                    // Show tooltip
                    tooltip
                        .html(authors + ". \"" + d.title + ".\" " + d.citation + ".")
                        .style("opacity", 1)
                        .style("left", (e.pageX + 10) + "px")
                        .style("top", (e.pageY + 10) + "px");


                })

                // Hide tooltip on mouse out
                .on("mouseout", () => {
                    tooltip.style("opacity", 0);
                })

                // Open link to doubleclick
                .on("click", (e, d) => {
                    window.open(d.link, "_blank");
                })

                // On window resize, update the position of the circles
                .on("resize.updatesvg", () => {
                    const newWidth = window.innerWidth;
                    const newHeight = window.innerHeight;

                    svg.attr('width', newWidth)
                        .attr('height', newHeight)
                        .attr('viewBox', `0 0 ${newWidth} ${newHeight}`)
                        // .attr('preserveAspectRatio', 'none');

                    // Update positions of circles, as well as sizes and radii
                    svg.selectAll("rect")
                        .attr("x", d => xScale(d.x_orig) - d.r)
                        .attr("y", d => yScale(d.y_orig) - d.r)
                        .attr("width", d => 2 * d.r)
                        .attr("height", d => 2 * d.r);
                });

        });
    </script>
</div>

<div class="row h-100 justify-content-center align-items-center " id="profile">
    <div class="card px-0">
        <!--        <button id="exit" type="button" class="btn-close" aria-label="Close"></button>-->
        <img alt="A headshot of {{ site.author }}" class="card-img-top"
             src="{{ site.headshot }}"/>
        <div class="card-body">
            <h5 class="card-title text-center">{{ site.author}}</h5>
            <h6 class="card-subtitle mb-2 text-muted text-center"> {{ site.affiliation }} </h6>
            <p class="card-text text-center">
                {{ content | markdownify | remove: '
            <p>' | remove: '</p>' }}
            </p>

            <div aria-label="Basic example" class="btn-group d-flex" role="group">
                <a aria-label=Email" class="btn btn-outline-dark" href="mailto:{{ site.email }}"
                   style="border-bottom-left-radius: 0"><i class="fa fa-envelope"></i></a>
                <a aria-label="Twitter" class="btn btn-outline-dark rounded-0"
                   href="https://twitter.com/{{ site.twitter }}"><i
                        class="fa fa-twitter"></i></a>
                <a aria-label="GitHub" class="btn btn-outline-dark rounded-0"
                   href="https://github.com/{{ site.github }}"><i
                        class="fa fa-github"></i></a>
                <a aria-label="Google Scholar" class="btn btn-outline-dark"
                   href="https://scholar.google.com/citations?user={{ site.google_scholar }}"
                   style="border-bottom-right-radius: 0"><i
                        class="fa fa-graduation-cap"></i></a>
            </div>
            <button class="btn btn-outline-dark w-100 rounded-0 rounded-bottom border-top-0" id="exit"
                    style="font-size: 0.9em;">
                <i class="fas fa-vector-square"></i>&nbsp;&nbsp;Explore Publications
            </button>
        </div>
    </div>
</div>

<footer class="footer mt-auto py-3" id="footer" style="z-index:-100;">
    <div class="container text-center">
        <span class="text-muted">&copy; <script>document.write(new Date().getFullYear())</script> {{ site.author | remove: ', Ph.D.' }}</span>
    </div>
</footer>
{% include scripts.html %}

</body>
</html>
